<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, width=device-width">
  <link rel="stylesheet" href="../../assets/css/style.css">
  <!-- packery.js -->
  <script src="https://unpkg.com/packery@2/dist/packery.pkgd.js"></script>
  <!-- draggie.js -->
  <script src="https://unpkg.com/draggabilly@3/dist/draggabilly.pkgd.min.js"></script>

  <script src="../../assets/js/script.js"></script>

  <title>GETIS</title>
</head>

<body>
  <div class="gts-gnb flex-group">
    <div class="prefix">
      <div class="home">
        <a href="" class="toggle-lnb">
          <i class="icon-lnb-toggle"></i>
        </a>
        <h1>
          <a href="">
            <i class="logo">GETIS</i>
          </a>
        </h1>
      </div>
      <div class="menu-list">
        <ul>
          <li class="on"><a href="">툴링 생산관리</a></li>
          <li><a href="">일반 관리</a></li>
          <li><a href="">전동화 생산관리</a></li>
          <li><a href="">협력사</a></li>
          <li><a href="">공통</a></li>
        </ul>
      </div>
    </div>
    <div class="suffix">
      <div class="gnb-menu">
        <ul>
          <li><a href=""><i class="icon-istm" title="ISTM"></i></a></li>
          <li><a href=""><i class="icon-app" title="app"></i></a></li>
          <li><a href=""><i class="icon-memo" title="memo"></i></a></li>
          <li><a href=""><i class="icon-help" title="help"></i></a></li>
          <li><a href=""><i class="icon-language" title="language"></i></a></li>
          <li><a href=""><i class="icon-mypage" title="mypage"></i></a></li>
        </ul>
      </div>
      <div class="mypage">
        <a href=""><span class="name">홍길동</span>&nbsp;님<span class="department">(기준정보시스템팀)</span></a>
      </div>
    </div>
  </div>
  <div class="content-wrap">
    <div class="gts-lnb">
      <div class="tab-container">
        <div class="header">
          <a href="" class="tab on" data-tab="tab-1"><i class="icon-star"></i>즐겨찾기</a>
          <a href="" class="tab" data-tab="tab-2"><i class="icon-time"></i>최근메뉴</a>
          <a href="" class="tab" data-tab="tab-3"><i class="icon-allmenu"></i>전체메뉴</a>
        </div>
        <div class="body">
          <div class="tab-content-wrap">
            <div class="tab-content tab-1 favorite-menu menu-tree">
              <ul class="depth--1">
                <li class="">
                  <a href="" class="has-depth">사용자 직접생성 폴더</a>
                  <ul class="depth--2">
                    <li>
                      <a href="" class="has-depth open">가동관리</a>
                      <ul class="depth--2">
                        <li>
                          <a href="" class="">가동관리222</a>
                        </li>
                        <li>
                          <a href="" class="">가동관리222</a>
                        </li>
                      </ul>
                    </li>
                    <li>
                      <a href="" class="has-depth">가동관리</a>
                      <ul class="depth--2">
                        <li>
                          <a href="" class="selected-menu">가동관리222</a>
                        </li>
                        <li>
                          <a href="" class="">가동관리222</a>
                        </li>
                      </ul>
                    </li>
                    <li><a href="">가동관리</a></li>
                    <li><a href="">no depth menu</a></li>
                  </ul>
                </li>
                <li>
                  <a href="" class="has-depth">
                    Folder 001
                  </a>
                  <ul class="depth--2">
                    <li>
                      <a href="">품목별 DIM'S 종합</a>
                    </li>
                    <li>
                      <a href="">총용접점 NG 현황 조회</a>
                    </li>
                    <li>
                      <a href="">총용접점 현황</a>
                    </li>
                    <li>
                      <a href="">후드 힌지면 측정현황</a>
                    </li>
                  </ul>
                </li>
                <li>
                  <a href="" class="has-depth open">
                    Folder 002
                  </a>
                  <ul class="depth--2">
                    <li>
                      <a href="" class="selected-menu">품목별 DIM'S 종합</a>
                    </li>
                    <li>
                      <a href="">총용접점 NG 현황 조회</a>
                    </li>
                    <li>
                      <a href="">총용접점 현황</a>
                    </li>
                    <li>
                      <a href="">후드 힌지면 측정현황</a>
                    </li>
                  </ul>
                </li>
                <li>
                  <a href="" class="has-depth">공장별 종합화면</a>
                  <ul class="depth--2">
                    <li>
                      <a href="">울산2공장</a>
                    </li>
                    <li>
                      <a href="">광주2공장</a>
                    </li>
                  </ul>
                </li>
              </ul>
              <div class="footer">
                <div class="btn-group">
                  <a href="" class="btn" onclick="editFavorite(this)">즐겨찾기관리</a>
                  <a href="" class="btn">Sitemap</a>
                </div>
              </div>
            </div>
            <div class="tab-content tab-1 favorite-menu menu-tree edit on">
              <div class="add">
                <input type="text" class="gts-input w-180" placeholder="폴더명/메뉴명 입력">
              </div>

              <div id="menu" class="menu">
                <div class="menu-content">
                  <ul id="menu-list">
                    <li class="draggable" draggable="true">
                      사용자 직접생성 폴더1 <span class="toggle-btn"><i class="icon-toggle-arrow-down"></i></span>
                      <ul class="sub-menu">
                        <li class="draggable" draggable="true">메뉴 1.1</li>
                        <li class="draggable" draggable="true">메뉴 1.2</li>
                      </ul>
                    </li>
                    <li class="draggable" draggable="true">
                      사용자 직접생성 폴더2 <span class="toggle-btn"><i class="icon-toggle-arrow-down"></i></span>
                      <ul class="sub-menu">
                        <li class="draggable" draggable="true">메뉴 2.1</li>
                        <li class="draggable" draggable="true">메뉴 2.2</li>
                      </ul>
                    </li>
                    <li class="draggable" draggable="true">
                      사용자 직접생성 메뉴3
                    </li>
                  </ul>
                </div>
              </div>

              <div class="footer">
                <div class="btn-group">
                  <a href="javascript:void(0)" class="btn" onclick="editFavorite(this)">즐겨찾기관리</a>
                  <a href="" class="btn">Sitemap</a>
                </div>
              </div>
            </div>
            <div class="tab-content tab-2 recent-menu">
              <ul class="editable-list">
                <li>
                  <a href="" class="remove" title="삭제">
                    <i class="icon-delete"></i>
                  </a>
                  <a href="" class="title">품목별 DIM’S 종합종합종합종합종합종합종합종합종합종합종합</a>
                  <div class="location">광주2 > 프레스 > 품질관리 > 신차품질관리</div>
                  <div class="date">22-04-16 07:14:44</div>
                </li>
                <li>
                  <a href="" class="remove" title="삭제">
                    <i class="icon-delete"></i>
                  </a>
                  <a href="" class="title">품목별 DIM’S 종합종합종합종합종합종합종합종합종합종합종합</a>
                  <div class="location">광주2 > 프레스 > 품질관리 > 신차품질관리</div>
                  <div class="date">22-04-16 07:14:44</div>
                </li>
              </ul>
              <div class="footer">
                <div class="btn-group">
                  <a href="" class="btn">Sitemap</a>
                </div>
              </div>
            </div>
            <div class="tab-content tab-3 all-menu menu-tree">
              <ul class="depth--1">
                <li class="">
                  <a href="" class="has-depth open">가동관리</a>
                  <ul class="depth--2">
                    <li>
                      <a href="" class="has-depth open">가동관리</a>
                      <ul class="depth--2">
                        <li>
                          <a href="" class="">가동관리222</a>
                        </li>
                        <li>
                          <a href="" class="">가동관리222</a>
                        </li>
                      </ul>
                    </li>
                    <li>
                      <a href="" class="has-depth">가동관리</a>
                      <ul class="depth--2">
                        <li>
                          <a href="" class="selected-menu">가동관리222</a>
                        </li>
                        <li>
                          <a href="" class="">가동관리222</a>
                        </li>
                      </ul>
                    </li>
                    <li><a href="">가동관리</a></li>
                    <li><a href="">no depth menu</a></li>
                  </ul>
                </li>
                <li class="">
                  <a href="" class="has-depth">품질관리</a>
                  <ul class="depth--2">
                    <li>
                      <a href="" class="has-depth open">품질관리</a>
                      <ul class="depth--2">
                        <li>
                          <a href="" class="">품질관리222</a>
                        </li>
                        <li>
                          <a href="" class="">품질관리222</a>
                        </li>
                      </ul>
                    </li>
                    <li>
                      <a href="" class="has-depth">품질관리</a>
                      <ul class="depth--2">
                        <li>
                          <a href="" class="">품질관리222</a>
                        </li>
                        <li>
                          <a href="" class="">품질관리222글자수max 품질관리222글자수max</a>
                        </li>
                      </ul>
                    </li>
                    <li>
                      <a href="" class="has-depth">품질관리 depth max test</a>
                      <ul class="depth--2">
                        <li>
                          <a href="" class="">품질관리222</a>
                        </li>
                        <li>
                          <a href="" class="has-depth">품질관리222글자수max 품질관리222글자수max</a>
                          <ul class="depth--2">
                            <li>
                              <a href="" class="has-depth">품질관리333</a>
                              <ul class="depth--2">
                                <li>
                                  <a href="" class="has-depth">품질관리444</a>
                                  <ul class="depth--2">
                                    <li>
                                      <a href="" class="has-depth">품질관리555</a>
                                      <ul class="depth--2">
                                        <li>
                                          <a href="" class="has-depth">품질관리666</a>
                                          <ul class="depth--2">
                                            <li>
                                              <a href="" class="has-depth">품질관리777</a>
                                              <ul class="depth--2">
                                                <li>
                                                  <a href="" class="has-depth">품질관리888</a>
                                                  <ul class="depth--2">
                                                    <li>
                                                      <a href="" class="has-depth">품질관리999</a>
                                                      <ul class="depth--2">
                                                        <li>
                                                          <a href="" class="">품질관리00000000-- 메뉴길이 테스트</a>
                                                        </li>
                                                      </ul>
                                                    </li>
                                                  </ul>
                                                </li>
                                              </ul>
                                            </li>
                                          </ul>
                                        </li>
                                      </ul>
                                    </li>
                                  </ul>
                                </li>
                              </ul>
                            </li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </li>
                <li class="">
                  <a href="" class="">운영관리</a>
                </li>
                <li class="">
                  <a href="" class="">보전관리</a>
                </li>
                <li class="">
                  <a href="" class="">보전관리</a>
                </li>
                <li class="">
                  <a href="" class="">보전관리</a>
                </li>
                <li class="">
                  <a href="" class="">보전관리</a>
                </li>
                <li class="">
                  <a href="" class="">보전관리</a>
                </li>
                <li class="">
                  <a href="" class="">보전관리</a>
                </li>
                <li class="">
                  <a href="" class="">보전관리</a>
                </li>
                <li class="">
                  <a href="" class="">보전관리</a>
                </li>
                <li class="">
                  <a href="" class="">보전관리</a>
                </li>
                <li class="">
                  <a href="" class="">보전관리</a>
                </li>
                <li class="">
                  <a href="" class="">보전관리</a>
                </li>
                <li class="">
                  <a href="" class="">보전관리</a>
                </li>
                <li class="">
                  <a href="" class="">보전관리</a>
                </li>
                <li class="">
                  <a href="" class="">보전관리</a>
                </li>
              </ul>
              <div class="footer">
                <div class="btn-group">
                  <a href="" class="btn">Sitemap</a>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</body>
<script>
  // LNB draggable
  let lnbFavEdit;
  let lnbGridElement;
  let lnbGridItems;
  let lnbDragged;
  let lnbDropTargetWidth;


  let favItem = document.querySelectorAll('.favorite-menu.edit .depth--1 > li');
  lnbGridElement = document.querySelector('.favorite-menu .grid');
  lnbGridItems = document.querySelectorAll('.favorite-menu .grid.depth--1 > li');

  lnbFavEdit = new Packery(lnbGridElement, {
    itemSelector: '.favorite-menu .grid > li'
  })

  console.log('lnbFavEdit', lnbFavEdit);

  // Menu Dragging

  const menu = document.getElementById('menu');
  let draggedItem = null;

  // Draggable functionality
  document.querySelectorAll('.draggable').forEach(item => {
    item.addEventListener('dragstart', (e) => {
      draggedItem = e.target;
      e.target.classList.add('dragging');
    });

    item.addEventListener('dragend', (e) => {
      e.target.classList.remove('dragging');
      draggedItem = null;
    });

    item.addEventListener('dragover', (e) => {
      e.preventDefault();
      console.log('dragover', e.target.classList);
      if (e.target.tagName === 'LI' && e.target !== draggedItem) {
        e.target.classList.add('drag-over');
        const rect = e.target.getBoundingClientRect();
        const offsetY = e.clientY - rect.top;
        console.log('drag', offsetY, rect.height / 2);
        if(offsetY < rect.height / 2){
          // 윗쪽
          e.target.classList.add('topper');
          e.target.classList.remove('bottom');
        } else {
          // 아랫쪽
          e.target.classList.add('bottom');
          e.target.classList.remove('topper');
        } 
      }
    });

    item.addEventListener('dragleave', (e) => {
      e.target.classList.remove('drag-over', 'topper');
    });
    item.addEventListener('drag', (e) => {
      // console.log('drag', e.target);
    })

    item.addEventListener('drop', (e) => {
      e.preventDefault();
      e.stopPropagation();
      e.target.classList.remove('drag-over', 'topper');
      e.target.style.backgroundColor = ''; // Reset background color

      if (e.target.tagName === 'LI' && e.target !== draggedItem) {
        const parent = e.target.parentNode;
        const allItems = Array.from(parent.children);
        const draggedIndex = allItems.indexOf(draggedItem);
        const targetIndex = allItems.indexOf(e.target);

        const rect = e.target.getBoundingClientRect();
        const offsetY = e.clientY - rect.top;
        console.log(offsetY, rect);
        if ( offsetY > rect.height / 2) {
          // 타겟의 아래쪽에 추가
          parent.insertBefore(draggedItem, e.target.nextSibling);
        } else {
          // 윗쪽에 추가
          parent.insertBefore(draggedItem, e.target);
        } 
        // else {
        //   let submenu = document.createElement('ul');
        //   submenu.classList.add('sub-menu');
        //   submenu.appendChild(draggedItem);
        //   let childItem = e.target.children;
        //   for(let i=0; i < childItem.length; i++){
        //     if(childItem[i].classList.contains('toggle-btn')){
        //       return false
        //     } else {
        //       e.target.innerHTML += '<span class="toggle-btn"><i class="icon-toggle-arrow-down"></i></span>';
        //       console.log('children', e.target);
        //     }
        //   }
        //   e.target.appendChild(submenu);
        //   let addBtn = e.target.querySelector('.toggle-btn');
        //   addBtn?handlerToggleBtn(addBtn):false;
        // }
      } else if (e.target.tagName === 'UL') {
        const ul = e.target;
        ul.appendChild(draggedItem);
      }
    });
  });

  // Menu Dragging
  let isDragging = false;
  let offsetX, offsetY;


  function onMouseMove(e) {
    if (isDragging) {
      menu.style.left = `${e.clientX - offsetX}px`;
      menu.style.top = `${e.clientY - offsetY}px`;
    }
  }

  function onMouseUp() {
    isDragging = false;
    document.removeEventListener('mousemove', onMouseMove);
    document.removeEventListener('mouseup', onMouseUp);
  }

  // Toggle Sub-menu
  document.querySelectorAll('.toggle-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const subMenu = btn.nextElementSibling;
      if (subMenu.style.display === 'none' || subMenu.style.display === '') {
        subMenu.style.display = 'block';
        btn.classList.add('open');
      } else {
        subMenu.style.display = 'none';
        btn.classList.remove('open');
      }
    });
  });
  function handlerToggleBtn(btn){
    const subMenu = btn.nextElementSibling;
    if (subMenu.style.display === 'none' || subMenu.style.display === '') {
      subMenu.style.display = 'block';
      btn.classList.add('open');
    } else {
      subMenu.style.display = 'none';
      btn.classList.remove('open');
    }
  }
  

</script>

</html>